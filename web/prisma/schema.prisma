// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// User model (extends Neon Auth user)
// Note: Auth data (email, password, sessions) lives in neon_auth schema
model User {
  id       String  @id  // UUID from Neon Auth (no @default, synced from auth)
  name     String?
  image    String?
  approved Boolean @default(false) // Admin must approve before user can access data

  assignedChores ChoreAssignment[]
  completions    ChoreCompletion[]
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

// Chore definition (the pool of tasks)
// Note: All chores are shared across the deployment (single household model)
model Chore {
  id          String    @id @default(uuid())
  title       String
  description String?
  frequency   Frequency // DAILY, WEEKLY, MONTHLY, YEARLY

  assignments ChoreAssignment[]
  schedules   Schedule[]
  completions ChoreCompletion[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Assignment of chore to a user
model ChoreAssignment {
  id      String @id @default(uuid())
  userId  String
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  choreId String
  chore   Chore  @relation(fields: [choreId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([userId, choreId])
}

// Scheduled instance (slot-based system)
model Schedule {
  id           String    @id @default(uuid())
  choreId      String
  chore        Chore     @relation(fields: [choreId], references: [id], onDelete: Cascade)

  scheduledFor DateTime  // When this task should be done
  slotType     Frequency // What kind of slot (WEEKLY, MONTHLY, etc)
  suggested    Boolean   @default(true) // Was this auto-suggested or manually selected

  completion ChoreCompletion?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([choreId, scheduledFor])
}

// Completion record
model ChoreCompletion {
  id         String    @id @default(uuid())
  choreId    String
  chore      Chore     @relation(fields: [choreId], references: [id], onDelete: Cascade)

  scheduleId String?   @unique
  schedule   Schedule? @relation(fields: [scheduleId], references: [id], onDelete: SetNull)

  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  completedAt DateTime @default(now())
  notes       String?
}

enum Frequency {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}
